# levi_robotarm
> è¯¾è®¾ROSæœºæ¢°è‡‚

## URDF
> æœ€ç»ˆæ–‡ä»¶`~/catkin_ws/src/levirobotarm`

> å‚è€ƒèµ„æ–™
> [ã€CSDNã€‘ç‰¹åˆ«ç« èŠ‚-0.1 SolidWorkså¯¼å‡ºæœºæ¢°è‡‚çš„URDFæ¨¡å‹å„ä¸ªå…³èŠ‚åæ ‡ç³»è®¾ç½®_sw2urdfå¯¼å…¥æ¨¡å‹å¦‚ä½•æ­£ç¡®è®¾ç½®åæ ‡ç³»](https://blog.csdn.net/shdhckcjc/article/details/129331111)
> [ã€å“”å“©å“”å“©ã€‘3.å¦‚ä½•ä»é›¶åˆ›å»ºä¸€ä¸ªæœºå™¨äººæ¨¡å‹_å¤æœˆå±…](https://www.bilibili.com/video/BV1Mg4y127Z9?spm_id_from=333.788.videopod.episodes&vd_source=ad2e2a33b4df3234b8ee276d3b21ba03&p=3)
> [ã€å“”å“©å“”å“©ã€‘Xarm6æœºæ¢°è‡‚â€”â€”ä»SolidWorkså¯¼å‡ºurdfå…¨è¿‡ç¨‹ã€ä¸Šç§‘å¤§ STARä¸­å¿ƒ RIM LABã€‘](https://www.bilibili.com/video/BV1QKsfegEmy/)
> [ã€å“”å“©å“”å“©ã€‘solidworkså¯¼å‡ºurdfæ–‡ä»¶æ“ä½œæµç¨‹](https://www.bilibili.com/video/BV1o34y1B7e4/?spm_id_from=333.337.search-card.all.click&vd_source=ad2e2a33b4df3234b8ee276d3b21ba03)
> [ã€å“”å“©å“”å“©ã€‘Solidworks æ’ä»¶å¯¼å‡º URDF](https://www.bilibili.com/video/BV1Ws4y1D7mB/?share_source=copy_web&vd_source=c31060872ab1071e0c6b7fd19c228efa)

æ‰“å¼€CQ24E-æœºæ¢°è‡‚è¿åŠ¨è£…é….SLDASM
![](./assets/levirobotarm_img/levirobotarm.png)
## æ·»åŠ å‚è€ƒè½´
æ·»åŠ åŸºå‡†è½´ç›®çš„æ˜¯è®©å…³èŠ‚å›´ç»•åŸºå‡†è½´æ—‹è½¬ï¼Œæ­¥éª¤å¦‚ä¸‹
![](./assets/levirobotarm_img/axis.png)
é€‰æ‹©åï¼Œç‚¹å‡»å…³èŠ‚å¤„ç”µæœºï¼Œä¼šç”Ÿæˆä¸€ä¸ªè½´ï¼Œç‚¹å‡»å¯¹å·ï¼Œå·¥ç¨‹æ ‘ä¸­é€‰ä¸­ç”Ÿæˆçš„è½´ï¼Œå³é”®é‡å‘½åæ ‘é¡¹ç›®ä¸º`axis_1`
![](./assets/levirobotarm_img/axis_1.png)
ä¾æ¬¡æ·»åŠ å‚è€ƒè½´
+ `axis_2`
![](./assets/levirobotarm_img/axis_2.png)
+ `axis_3`
![](./assets/levirobotarm_img/axis_3.png)
+ `axis_4`
![](./assets/levirobotarm_img/axis_4.png)
+ `axis_5`
![](./assets/levirobotarm_img/axis_5.png)
## æ·»åŠ åŸç‚¹
æ·»åŠ ç‚¹ç›®çš„æ˜¯å»ºç«‹åæ ‡ç³»åŸç‚¹ï¼Œæ­¥éª¤å¦‚ä¸‹
![](./assets/levirobotarm_img/point.png)
+ `point_1`
![](./assets/levirobotarm_img/point_1.png)
+ `point_2`
![](./assets/levirobotarm_img/point_2.png)
+ `point_3`
![](./assets/levirobotarm_img/point_3.png)
+ `point_4`
![](./assets/levirobotarm_img/point_4.png)
+ `point_5`
![](./assets/levirobotarm_img/point_5.png)
+ `point_6`
![](./assets/levirobotarm_img/point_6.png)
## å»ºç«‹åæ ‡ç³»
æ³¨æ„äº‹é¡¹ï¼š
Zè½´è¦å’Œæ—‹è½¬è½´é‡åˆ
Xè½´å‚ç›´ç›¸äº¤äºä¸Šä¸€ä¸ªlinkæ—‹è½¬è½´

> è¯¦æƒ…å†…å®¹å‚è€ƒ
>
> ğŸ‘‰[ã€CSDNã€‘ç‰¹åˆ«ç« èŠ‚-0.1 SolidWorkså¯¼å‡ºæœºæ¢°è‡‚çš„URDFæ¨¡å‹å„ä¸ªå…³èŠ‚åæ ‡ç³»è®¾ç½®_sw2urdfå¯¼å…¥æ¨¡å‹å¦‚ä½•æ­£ç¡®è®¾ç½®åæ ‡ç³»](https://blog.csdn.net/shdhckcjc/article/details/129331111)ğŸ‘ˆ

![](./assets/levirobotarm_img/cordinate.png)
+ `base_co`
![](./assets/levirobotarm_img/base_co.png)
æœ€ç»ˆå·¥ç¨‹æ ‘ç»“æ„å¦‚ä¸‹
![](./assets/levirobotarm_img/tree.png)
## sw2urdf
æ‰“å¼€æ’ä»¶å·¥å…·
![](./assets/levirobotarm_img/export.png)
+ `base_link`
ç‚¹å‡»å³ä¾§å±•å¼€æ¨¡å‹è§†å›¾ï¼Œé€‰æ‹©å¤§è‡‚åº•åº§
![](./assets/levirobotarm_img/base_link.png)
+ `link_1`
![](./assets/levirobotarm_img/link_1.png)
+ `link_2`
![](./assets/levirobotarm_img/link_2.png)
+ `link_3`
![](./assets/levirobotarm_img/link_3.png)
+ `link_4`
![](./assets/levirobotarm_img/link_4.png)
+ `link_5`
![](./assets/levirobotarm_img/link_5.png)
> link4å’Œlink5åŒ…å«åœ¨ä¸€ä¸ªæ€»ä½“é‡Œï¼Œè¦åˆ†å¼€é€‰

`preview and export`
æ¯ä¸ª`joint`æ·»åŠ `limit`
![](./assets/levirobotarm_img/limit.png)
`next`->`finish`
ä¿å­˜åä¸º`levirobotarm`

+ å°†`/levirobotarm/launch`æ–‡ä»¶å¤¹ä¸‹`display.launch`å’Œ`gazebo.launch`å†…`/robots/`æ”¹ä¸º`/urdf/`
+ å°†`/levirobotarm`æ–‡ä»¶å¤¹ä¸‹`package.xml`å†…`me2email.com`æ”¹ä¸º`me@email.com`
+ ç¼–è¯‘
```bash
cd ~/catkin_ws
catkin_make
```
+ è¿è¡Œ
```bash
roslaunch levirobotarm display.launch
```

```bash
roslaunch levirobotarm gazebo.launch
```
![](./assets/levirobotarm_img/rviz.png)
+ `fixed frame`ä¸‹æ‹‰é€‰æ‹©`base_link`

+ `add`æ·»åŠ `robotmodel`
  ![](./assets/levirobotarm_img/joint_state.png)


å¦‚è¦ä¿å­˜é…ç½®
```bash
su
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```
ç„¶åå†ä¿å­˜
## xacro
1. åˆ›å»ºxacroæ–‡ä»¶
```bash
cd ~/catkin_ws/src/levirobotarm/urdf
touch levirobotarm.xacro
```
å¤åˆ¶`levirobotarm.urdf`å†…å®¹åˆ°`levirobotarm.xacro`
å°†urdfå¼€å¤´
```
<robot
  name="levirobotarm">
```
ä¿®æ”¹ä¸ºxacroå¼€å¤´
```
<?xml version="1.0"?>
<robot name="levirobotarm" xmlns:xacro="http://ros.org/wiki/xacro">
```
2. ä¿®æ”¹launchæ–‡ä»¶
`~/catkin_ws/src/levirobotarm/launch/display.launch`
```
<param
    name="robot_description"
    textfile="$(find levirobotarm)/urdf/levirobotarm.urdf" />
```
ä¿®æ”¹ä¸º
```
<!-- åŠ è½½æœºå™¨äººæ¨¡å‹å‚æ•° -->
  <param name="robot_description" command="$(find xacro)/xacro --inorder $(find levirobotarm)/urdf/levirobotarm.xacro" />
```

## MoveIt!
> æœ€ç»ˆæ–‡ä»¶`~/catkin_ws/src/levirobotarm_moveit_config`
## åˆ›å»ºåŒ…
1. `MoveIt Setup Assistant`
```bash
roslaunch moveit_setup_assistant setup_assistant.launch
```
2. é€‰æ‹©æ¨¡å‹
+ åˆ›å»ºåŒ…`create new moveit configuration package`
![](./assets/levirobotarm_img/create_moveit_cfg_pkg.png)
+ `load file`
`~/catkin_ws/src/levirobotarm/urdf/levirobotarm.xacro`
![](./assets/levirobotarm_img/load_file.png)
3. è‡ªç¢°æ’æ£€æµ‹
`generate collision matrix`
![](./assets/levirobotarm_img/self_collisions.png)
4. è§„åˆ’ç»„
- `add group`
`~/catkin_ws/src/levirobotarm/config/kinematics.yaml`
å†…å®¹å¦‚ä¸‹
```yaml
manipulator:
  kinematics_solver: kdl_kinematics_plugin/KDLKinematicsPlugin
  kinematics_solver_search_resolution: 0.005
  kinematics_solver_timeout: 0.005
  kinematics_solver_attempts: 3
```
![](./assets/levirobotarm_img/planning_group.png)
+ `add kin. chain`
![](./assets/levirobotarm_img/base_tip.png)
+ `save`
![](./assets/levirobotarm_img/save_planning.png)
5. é¢„å®šä¹‰å§¿æ€
- `add pose`
![](./assets/levirobotarm_img/home_pose.png)
![](./assets/levirobotarm_img/upward_pose.png)
6. ä½œè€…ä¿¡æ¯
![](./assets/levirobotarm_img/author.png)
7. ç”Ÿæˆé…ç½®åŠŸèƒ½åŒ…
`~/catkin_ws/src/levirobotarm_moveit_config`
![](./assets/levirobotarm_img/generate_cfg_pkg.png)
## ç¼–è¯‘æµ‹è¯•
```bash
cd ~/catkin_ws
catkin_make
```

```bash
roslaunch levirobotarm_moveit_config demo.launch
```
![](./assets/levirobotarm_img/allow_approx.png)
å‹¾é€‰`Approx IK Solutions`ï¼Œå¦åˆ™æ— æ³•æ‹–åŠ¨è½¨è¿¹çƒ
![](./assets/levirobotarm_img/levirobotarm_moveit.gif)
å¦‚è¦ä¿å­˜é…ç½®
```bash
su
cd ~/catkin_ws
source devel/setup.bash
```
ç„¶åå†ä¿å­˜

## Gazebo
> æœ€ç»ˆæ–‡ä»¶`~/catkin_ws/src/levirobotarm_gazebo`
## å®Œå–„æ¨¡å‹
1. ä¸ºlinkæ·»åŠ æƒ¯æ€§å‚æ•°å’Œç¢°æ’å±æ€§
æ‰“å¼€`~/catkin_ws/src/levirobotarm/urdf/levirobotarm.xacro`
ä¿®æ”¹mass value, ixx, ixy, ixz, iyy, iyz, izz
```xml
<link
    name="base_link">
    <inertial>
      <origin
        xyz="-0.111499999999999 0.0918805537950462 0.0365980539672176"
        rpy="0 0 0" />
      <mass
        value="0.00001" />
      <inertia
        ixx="10"
        ixy="0.0"
        ixz="0.0"
        iyy="10"
        iyz="0.0"
        izz="10" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://levirobotarm/meshes/base_link.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://levirobotarm/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>
```
2. ä¸ºjointæ·»åŠ ä¼ åŠ¨è£…ç½®
æ‰“å¼€`~/catkin_ws/src/levirobotarm/urdf/levirobotarm.xacro`ï¼Œåœ¨æœ€åä¸€ä¸ªjointæ ‡ç­¾åæ·»åŠ 
```xml
<!-- Transmissions for ROS Control -->
  <xacro:macro name="transmission_block" params="joint_name">
    <transmission name="tran1">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${joint_name}">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="motor1">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>
  
  <xacro:transmission_block joint_name="joint1"/>
  <xacro:transmission_block joint_name="joint2"/>
  <xacro:transmission_block joint_name="joint3"/>
  <xacro:transmission_block joint_name="joint4"/>
  <xacro:transmission_block joint_name="joint5"/>
```
3. æ·»åŠ gazeboæ§åˆ¶å™¨æ’ä»¶
ç´§æ¥ä¸Šæ–‡ï¼Œåœ¨åé¢æ·»åŠ 
```xml
<!-- ros_control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/levirobotarm</robotNamespace>
      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
      <legacyModeNS>true</legacyModeNS>
    </plugin>
  </gazebo>
```
## Gazeboæ–‡ä»¶å¤¹

1. åˆ›å»ºæ–‡ä»¶å¤¹
å¤åˆ¶`~/catkin_ws/src/levirobotarm`å¹¶é‡å‘½åä¸º`~/catkin_ws/src/levirobotarm_gazebo`
åˆ é™¤meshes, textures, urdfæ–‡ä»¶å¤¹
2. ä¿®æ”¹CMakeLists.txtæ–‡ä»¶
`levirobotarm`æ”¹ä¸º`levirobotarm_gazebo`
```
project(levirobotarm_gazebo)
```
3. ä¿®æ”¹package.xml
`levirobotarm`æ”¹ä¸º`levirobotarm_gazebo`
```xml
<name>levirobotarm_gazebo</name>
```
4. æ‰§è¡Œæ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/launch
touch levirobotarm_gazebo.launch
```
`levirobotarm_gazebo.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>
  <!-- these are the arguments you can pass this launch file, for example paused:=true -->
  <arg name="paused" default="false"/>
  <arg name="use_sim_time" default="true"/>
  <arg name="gui" default="true"/>
  <arg name="headless" default="false"/>
  <arg name="debug" default="false"/>
  <!-- We resume the logic in empty_world.launch -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="debug" value="$(arg debug)" />
    <arg name="gui" value="$(arg gui)" />
    <arg name="paused" value="$(arg paused)"/>
    <arg name="use_sim_time" value="$(arg use_sim_time)"/>
    <arg name="headless" value="$(arg headless)"/>
  </include>
  <!-- Load the URDF into the ROS Parameter Server -->
  <param name="robot_description" command="$(find xacro)/xacro --inorder '$(find levirobotarm)/urdf/levirobotarm.xacro'" /> 
  <!-- Run a python script to the send a service call to gazebo_ros to spawn a URDF robot -->
  <node name="urdf_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
	args="-urdf -model levirobotarm -param robot_description"/> 
</launch>
```
## ç¼–è¯‘æµ‹è¯•
```bash
cd ~/catkin_ws
catkin_make
```

```bash
roslaunch levirobotarm_gazebo levirobotarm_gazebo.launch
```
![](./assets/levirobotarm_img/gazebo.png)

## MoveIt! + Gazebo
> [Unable to identify any set of controllers that can actuate the specified joints:-CSDNåšå®¢](https://blog.csdn.net/weixin_42314494/article/details/124022605)

![](./assets/levirobotarm_img/robot_frame.png)
> æœ€ç»ˆæ–‡ä»¶`~/catkin_ws/src/levirobotarm_gazebo`
## joint trajectory controller
+ é…ç½®æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo/config`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/config
touch levirobotarm_trajectory_control.yaml
```
`levirobotarm_trajectory_control.yaml`å†…å®¹å¦‚ä¸‹
```yaml
levirobotarm:
  arm_joint_controller:
    type: "position_controllers/JointTrajectoryController"
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
      - joint5

    gains:
      joint1:   {p: 1000.0, i: 0.0, d: 0.1, i_clamp: 0.0}
      joint2:   {p: 1000.0, i: 0.0, d: 0.1, i_clamp: 0.0}
      joint3:   {p: 1000.0, i: 0.0, d: 0.1, i_clamp: 0.0}
      joint4:   {p: 1000.0, i: 0.0, d: 0.1, i_clamp: 0.0}
      joint5:   {p: 1000.0, i: 0.0, d: 0.1, i_clamp: 0.0}
```

+ å¯åŠ¨æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo/launch`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/launch
touch levirobotarm_trajectory_controller.launch
```
`levirobotarm_trajectory_controller.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>

    <rosparam file="$(find levirobotarm_gazebo)/config/levirobotarm_trajectory_control.yaml" command="load"/>

    <node name="arm_controller_spawner" pkg="controller_manager" type="spawner" respawn="false"
          output="screen" ns="/levirobotarm" args="arm_joint_controller"/>

</launch>
```

## joint state controller
+ é…ç½®æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo/config`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/config
touch levirobotarm_joint_states.yaml
```
`levirobotarm_joint_states.yaml`å†…å®¹å¦‚ä¸‹
```yaml
levirobotarm:
  # Publish all joint states -----------------------------------
  joint_state_controller:
    type: joint_state_controller/JointStateController
    publish_rate: 50  
```

+ å¯åŠ¨æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo/launch`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/launch
touch levirobotarm_states.launch
```
`levirobotarm_states.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>
    <!-- å°†å…³èŠ‚æ§åˆ¶å™¨çš„é…ç½®å‚æ•°åŠ è½½åˆ°å‚æ•°æœåŠ¡å™¨ä¸­ -->
    <rosparam file="$(find levirobotarm_gazebo)/config/levirobotarm_joint_states.yaml" command="load"/>

    <node name="joint_controller_spawner" pkg="controller_manager" type="spawner" respawn="false"
          output="screen" ns="/levirobotarm" args="joint_state_controller" />

    <!-- è¿è¡Œrobot_state_publisherèŠ‚ç‚¹ï¼Œå‘å¸ƒtf  -->
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
        respawn="false" output="screen">
        <remap from="/joint_states" to="/levirobotarm/joint_states" />
    </node>
</launch>
```

## follow joint trajectory
+ é…ç½®æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_moveit_config/config`
```bash
cd ~/catkin_ws/src/levirobotarm_moveit_config/config
touch levirobotarm_controllers_gazebo.yaml
```
`levirobotarm_controllers_gazebo.yaml`å†…å®¹å¦‚ä¸‹
```yaml
controller_manager_ns: controller_manager
controller_list:
  - name: levirobotarm/arm_joint_controller
    action_ns: follow_joint_trajectory
    type: FollowJointTrajectory
    default: true
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
      - joint5
```
æŠ¥é”™
```bash
[ERROR] [1729342811.504048590, 26.258000000]: Unable to identify any set of controllers that can actuate the specified joints: [ joint1 joint2 joint3 joint4 joint5 ] 
[ERROR] [1729342811.504222788, 26.258000000]: Known controllers and their joints: 
[ERROR] [1729342811.504361887, 26.258000000]: Apparently trajectory initialization failed
```
ä¿®æ”¹`ros_controllers.yaml`å†…å®¹å¦‚ä¸‹
```yaml
# Simulation settings for using moveit_sim_controllers
moveit_sim_hw_interface:
  joint_model_group: controllers_initial_group_
  joint_model_group_pose: controllers_initial_pose_
# Settings for ros_control_boilerplate control loop
generic_hw_control_loop:
  loop_hz: 300
  cycle_time_error_threshold: 0.01
# Settings for ros_control hardware interface
hardware_interface:
  joints:
    - joint1
    - joint2
    - joint3
    - joint4
    - joint5
  sim_control_mode: 1  # 0: position, 1: velocity
# Publish all joint states
# Creates the /joint_states topic necessary in ROS
joint_state_controller:
  type: joint_state_controller/JointStateController
  publish_rate: 50
#controller_list:
#  []
controller_list:
  - name: levirobotarm/arm_joint_controller
    action_ns: follow_joint_trajectory
    type: FollowJointTrajectory
    default: true
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
      - joint5
```

+ å¯åŠ¨æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_moveit_config/launch`
```bash
cd ~/catkin_ws/src/levirobotarm_moveit_config/launch
touch levirobotarm_moveit_controller_manager.launch
```
`levirobotarm_moveit_controller_manager.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>
    <arg name="moveit_controller_manager" default="moveit_simple_controller_manager/MoveItSimpleControllerManager"/>
    <param name="moveit_controller_manager" value="$(arg moveit_controller_manager)"/>

	<!-- gazebo Controller -->
	<rosparam file="$(find levirobotarm_moveit_config)/config/levirobotarm_controllers_gazebo.yaml"/>

</launch>
```

`~/catkin_ws/src/levirobotarm_moveit_config/launch`
```bash
cd ~/catkin_ws/src/levirobotarm_moveit_config/launch
touch levirobotarm_moveit_planning_execution.launch
```
`levirobotarm_moveit_planning_execution.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>
 # The planning and execution components of MoveIt! configured to 
 # publish the current configuration of the robot (simulated or real)
 # and the current state of the world as seen by the planner
 <include file="$(find levirobotarm_moveit_config)/launch/move_group.launch">
  <arg name="publish_monitored_planning_scene" value="true" />
 </include>

 # The visualization component of MoveIt!
 <include file="$(find levirobotarm_moveit_config)/launch/moveit_rviz.launch">
  <arg name="config" value="true" />
 </include>

  <!-- We do not have a robot connected, so publish fake joint states -->
  <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
    <param name="/use_gui" value="false"/> 
    <rosparam param="/source_list">[/levirobotarm/joint_states]</rosparam>
  </node>

</launch>
```
`moveit_rviz.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>

  <arg name="debug" default="false" />
  <arg unless="$(arg debug)" name="launch_prefix" value="" />
  <arg     if="$(arg debug)" name="launch_prefix" value="gdb --ex run --args" />

  <arg name="config" default="false" />
  <arg unless="$(arg config)" name="command_args" default="" />
  <arg     if="$(arg config)" name="command_args" default="-d $(find levirobotarm_moveit_config)/launch/moveit.rviz" />

  <node name="$(anon rviz)" launch-prefix="$(arg launch_prefix)" pkg="rviz" type="rviz" respawn="false"
        args="$(arg command_args)" output="screen">
  <rosparam command="load" file="$(find levirobotarm_moveit_config)/config/kinematics.yaml"/>
  </node>

</launch>
```

## moveit_gazebo
å¯åŠ¨æ–‡ä»¶
`~/catkin_ws/src/levirobotarm_gazebo/launch`
```bash
cd ~/catkin_ws/src/levirobotarm_gazebo/launch
touch levirobotarm_bringup_moveit.launch
```
`levirobotarm_bringup_moveit.launch`å†…å®¹å¦‚ä¸‹
```xml
<launch>
  
    <!-- Launch Gazebo  -->
    <include file="$(find levirobotarm_gazebo)/launch/levirobotarm_gazebo.launch" />

    <!-- ros_control arm launch file -->
    <include file="$(find levirobotarm_gazebo)/launch/levirobotarm_states.launch" />   

    <!-- ros_control trajectory control dof arm launch file -->
    <include file="$(find levirobotarm_gazebo)/launch/levirobotarm_trajectory_controller.launch" />

    <!-- moveit launch file -->
    <include file="$(find levirobotarm_moveit_config)/launch/levirobotarm_moveit_planning_execution.launch" />

</launch>
```

```bash
roslaunch levirobotarm_gazebo levirobotarm_bringup_moveit.launch
```
![](./assets/levirobotarm_img/levirobotarm_moveit_gazebo.gif)

## MoveIt!ç¼–ç¨‹
> æœ€ç»ˆæ–‡ä»¶`~/catkin_ws/src/levirobotarm_demo`
> æ–‡ä»¶æ”¹è‡ªå¤æœˆå±…`probot_demo`

å¤åˆ¶`probot_demo`æ–‡ä»¶å¹¶é‡å‘½åä¸º`levirobotarm_demo`
å°†`CMakeLists.txt`å’Œ`package.xml`æ–‡ä»¶ä¸­`probot_demo`ä¿®æ”¹ä¸º`levirobotarm_demo`

```bash
cd ~/catkin_ws
catkin_make
```
## å…³èŠ‚ç©ºé—´è¿åŠ¨
### æ­£å‘è¿åŠ¨å­¦è§„åˆ’
+ ç¨‹åº
`~/catkin_ws/src/levirobotarm_demo/scripts/moveit_fk_demo.py`ç¨‹åºå†…å®¹å¦‚ä¸‹
```python
# -*- coding: utf-8 -*-
import rospy, sys
import moveit_commander
class MoveItFkDemo:
    def __init__(self):
        # åˆå§‹åŒ–move_groupçš„API
        moveit_commander.roscpp_initialize(sys.argv)
        # åˆå§‹åŒ–ROSèŠ‚ç‚¹
        rospy.init_node('moveit_fk_demo', anonymous=True)
        # åˆå§‹åŒ–éœ€è¦ä½¿ç”¨move groupæ§åˆ¶çš„æœºæ¢°è‡‚ä¸­çš„arm group
        arm = moveit_commander.MoveGroupCommander('manipulator')
        # è®¾ç½®æœºæ¢°è‡‚è¿åŠ¨çš„å…è®¸è¯¯å·®å€¼
        arm.set_goal_joint_tolerance(0.001)
        # è®¾ç½®å…è®¸çš„æœ€å¤§é€Ÿåº¦å’ŒåŠ é€Ÿåº¦ 0~1
        arm.set_max_acceleration_scaling_factor(0.5)
        arm.set_max_velocity_scaling_factor(0.5)
        # æ§åˆ¶æœºæ¢°è‡‚å…ˆå›åˆ°åˆå§‹åŒ–ä½ç½®
        arm.set_named_target('home')
        # plan execute
        arm.go()
        rospy.sleep(1)
        # è®¾ç½®æœºæ¢°è‡‚çš„ç›®æ ‡ä½ç½®ï¼Œä½¿ç”¨äº”è½´çš„ä½ç½®æ•°æ®è¿›è¡Œæè¿°ï¼ˆå•ä½ï¼šå¼§åº¦ï¼‰
        joint_positions = [0.391410, -0.676384, -0.376217, 0.0, 1.052834]
        arm.set_joint_value_target(joint_positions)
        # æ§åˆ¶æœºæ¢°è‡‚å®Œæˆè¿åŠ¨
        arm.go()
        rospy.sleep(1)
        # æ§åˆ¶æœºæ¢°è‡‚å…ˆå›åˆ°åˆå§‹åŒ–ä½ç½®
        arm.set_named_target('home')
        arm.go()
        rospy.sleep(1)
        # å…³é—­å¹¶é€€å‡ºmoveit
        moveit_commander.roscpp_shutdown()
        moveit_commander.os._exit(0)
if __name__ == "__main__":
    try:
        MoveItFkDemo()
    except rospy.ROSInterruptException:
        pass
```
+ è¿è¡Œ
è¿è¡Œrvizç•Œé¢
```bash
roslaunch levirobotarm_moveit_config demo.launch
```
è¿è¡Œç¨‹åº
```bash
rosrun levirobotarm_demo moveit_fk_demo.py
```
![](./assets/levirobotarm_img/levirobotarm_moveit_fk.gif)

### é€†å‘è¿åŠ¨å­¦è§„åˆ’
+ ç¨‹åº
`~/catkin_ws/src/levirobotarm_demo/scripts/moveit_ik_demo.py`ç¨‹åºå†…å®¹å¦‚ä¸‹
```python
# -*- coding: utf-8 -*-
import rospy, sys
import moveit_commander
from geometry_msgs.msg import PoseStamped, Pose
class MoveItIkDemo:
    def __init__(self):
        # åˆå§‹åŒ–move_groupçš„API
        moveit_commander.roscpp_initialize(sys.argv)
        # åˆå§‹åŒ–ROSèŠ‚ç‚¹
        rospy.init_node('moveit_ik_demo')
        # åˆå§‹åŒ–éœ€è¦ä½¿ç”¨move groupæ§åˆ¶çš„æœºæ¢°è‡‚ä¸­çš„arm group
        arm = moveit_commander.MoveGroupCommander('manipulator')
        # è·å–ç»ˆç«¯linkçš„åç§°
        end_effector_link = arm.get_end_effector_link()
        # è®¾ç½®ç›®æ ‡ä½ç½®æ‰€ä½¿ç”¨çš„å‚è€ƒåæ ‡ç³»
        reference_frame = 'base_link'
        arm.set_pose_reference_frame(reference_frame)
        # å½“è¿åŠ¨è§„åˆ’å¤±è´¥åï¼Œå…è®¸é‡æ–°è§„åˆ’
        arm.allow_replanning(True)
        # è®¾ç½®ä½ç½®(å•ä½ï¼šç±³)å’Œå§¿æ€ï¼ˆå•ä½ï¼šå¼§åº¦ï¼‰çš„å…è®¸è¯¯å·®
        arm.set_goal_position_tolerance(0.001)
        arm.set_goal_orientation_tolerance(0.01)
        # è®¾ç½®å…è®¸çš„æœ€å¤§é€Ÿåº¦å’ŒåŠ é€Ÿåº¦
        arm.set_max_acceleration_scaling_factor(0.5)
        arm.set_max_velocity_scaling_factor(0.5)
        # æ§åˆ¶æœºæ¢°è‡‚å…ˆå›åˆ°åˆå§‹åŒ–ä½ç½®
        arm.set_named_target('home')
        arm.go()
        rospy.sleep(1)
        # è®¾ç½®æœºæ¢°è‡‚å·¥ä½œç©ºé—´ä¸­çš„ç›®æ ‡ä½å§¿ï¼Œä½ç½®ä½¿ç”¨xã€yã€zåæ ‡æè¿°ï¼Œ
        # å§¿æ€ä½¿ç”¨å››å…ƒæ•°æè¿°ï¼ŒåŸºäºbase_linkåæ ‡ç³»
        target_pose = PoseStamped()
        target_pose.header.frame_id = reference_frame
        target_pose.header.stamp = rospy.Time.now()     
        target_pose.pose.position.x = -0.100901
        target_pose.pose.position.y = 0.192478
        target_pose.pose.position.z = 0.492304
        target_pose.pose.orientation.x = 0.523656
        target_pose.pose.orientation.y = -0.523583
        target_pose.pose.orientation.z = -0.475238
        target_pose.pose.orientation.w = -0.475178
        # è®¾ç½®æœºå™¨è‡‚å½“å‰çš„çŠ¶æ€ä½œä¸ºè¿åŠ¨åˆå§‹çŠ¶æ€
        arm.set_start_state_to_current_state()
        # è®¾ç½®æœºæ¢°è‡‚ç»ˆç«¯è¿åŠ¨çš„ç›®æ ‡ä½å§¿
        arm.set_pose_target(target_pose, end_effector_link)
        # è§„åˆ’è¿åŠ¨è·¯å¾„
        traj = arm.plan()
        # æŒ‰ç…§è§„åˆ’çš„è¿åŠ¨è·¯å¾„æ§åˆ¶æœºæ¢°è‡‚è¿åŠ¨
        arm.execute(traj)
        # arm.go()
        rospy.sleep(1)
        # æ§åˆ¶æœºæ¢°è‡‚å›åˆ°åˆå§‹åŒ–ä½ç½®
        arm.set_named_target('home')
        arm.go()
        # å…³é—­å¹¶é€€å‡ºmoveit
        moveit_commander.roscpp_shutdown()
        moveit_commander.os._exit(0)
if __name__ == "__main__":
    MoveItIkDemo()
```
+ è¿è¡Œ
è¿è¡Œrvizç•Œé¢
```bash
roslaunch levirobotarm_moveit_config demo.launch
```
è¿è¡Œç¨‹åº
```bash
rosrun levirobotarm_demo moveit_ik_demo.py
```

![](./assets/levirobotarm_img/levirobotarm_moveit_ik.gif)

## å‚è€ƒèµ„æ–™

> [ã€å¤æœˆå±…ã€‘ROSæœºæ¢°è‡‚å¼€å‘ï¼šä»å…¥é—¨åˆ°å®æˆ˜-å“”å“©å“”å“©](https://www.bilibili.com/video/BV1Mg4y127Z9?spm_id_from=333.788.videopod.episodes&vd_source=ad2e2a33b4df3234b8ee276d3b21ba03&p=3)
>
> [ã€å¤æœˆå±…ã€‘ROSæœºæ¢°è‡‚å¼€å‘ï¼šä»å…¥é—¨åˆ°å®æˆ˜-ä»£ç ](https://pan.baidu.com/s/1Oy6Wm35GUrpyejAarrPGDQ?pwd=1005) æå–ç ï¼š1005
>
> [ã€å“ˆè¨å…‹æ–¯å¦xã€‘ROSæœºæ¢°è‡‚å…¥é—¨æ•™ç¨‹-å“”å“©å“”å“©](https://www.bilibili.com/video/BV1984y187Nq/?spm_id_from=333.788.videopod.sections&vd_source=ad2e2a33b4df3234b8ee276d3b21ba03)
>
> [ã€å“ˆè¨å…‹æ–¯å¦xã€‘ rosæœºæ¢°è‡‚å…¥é—¨æ•™ç¨‹-ä»£ç  version3.0](https://pan.baidu.com/s/1KFLQXVWShG5KfroCd6eM0A) æå–ç ï¼š<font style="color:rgb(51, 51, 51);">8888</font>

